[
  // Extra state for Satoshi to trigger the new cutscene
  {
    "type": "ENTER",
    "index": ["entities", 94, "settings", "npcStates"]
  },
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "reactType": "FIXED_FACE",
      "face": "NORTH",
      "action": [
        {
          "wait": false,
          "viaWalkConfig": false,
          "type": "SHOW_ANIMATION",
          "anim": "chairTyping"
        },
        {
          "type": "WAIT",
          "time": 1
        },
        {
          "wait": false,
          "viaWalkConfig": false,
          "type": "SHOW_ANIMATION",
          "anim": "chairClicking"
        },
        {
          "type": "WAIT",
          "time": 0.5
        }
      ],
      "hidden": false,
      "condition": "plot.line >= 52000 && plot.projred.line == 200",
      "config": "chair",
      "event": [
        {
          "type": "CLEAR_TASK"
        },
        {
          "person": {
            "person": "main.lea",
            "expression": "DEFAULT"
          },
          "type": "ADD_MSG_PERSON",
          "side": "RIGHT"
        },
        {
          "person": {
            "person": "main.genius",
            "expression": "CHAIR_SIDE"
          },
          "type": "ADD_MSG_PERSON",
          "side": "LEFT"
        },
        {
          "person": {
            "person": "main.lea",
            "expression": "DEFAULT"
          },
          "message": {
            "en_US": "Hi!"
          },
          "type": "SHOW_MSG"
        },
        {
          "changeType": "set",
          "type": "CHANGE_VAR_BOOL",
          "varName": "tmp.codeStopped",
          "value": true
        },
        {
          "entity": {
            "global": true,
            "name": "satoshi"
          },
          "action": [
            {
              "entity": {
                "player": true
              },
              "rotate": false,
              "rotateSpeed": 3,
              "type": "SET_FACE_TO_ENTITY"
            },
            {
              "wait": false,
              "viaWalkConfig": false,
              "type": "SHOW_ANIMATION",
              "anim": "chairLookSideway"
            },
            {
              "type": "WAIT",
              "time": -1
            }
          ],
          "repeating": false,
          "wait": false,
          "keepState": true,
          "immediately": false,
          "type": "DO_ACTION"
        },
        {
          "person": {
            "person": "main.genius",
            "expression": "CHAIR_SIDE"
          },
          "message": {
            "en_US": "Hello Lea."
          },
          "type": "SHOW_MSG"
        },
        {
          "person": {
            "person": "main.genius",
            "expression": "CHAIR_DOWN"
          },
          "message": {
            "en_US": "Please, take a seat, we have something important to discuss."
          },
          "type": "SHOW_MSG"
        },
        {
          "person": {
            "person": "main.lea",
            "expression": "SURPRISED_TOWARD"
          },
          "message": {
            "en_US": "..."
          },
          "type": "SHOW_MSG"
        },
        {
          "type": "CLEAR_MSG",
          "side": "ALL"
        },
        {
          "type": "PAUSE_BGM",
          "mode": "MEDIUM"
        },
        {
          "overMessage": false,
          "type": "SET_OVERLAY",
          "color": "black",
          "alpha": 1,
          "time": 1
        },
        {
          "type": "WAIT",
          "time": 1
        },
        {
          "type": "CHANGE_VAR_NUMBER",
          "varName": "plot.projred.line",
          "changeType": "set",
          "value": 210
        }
      ]
    }
  },
  // <- entities
  {
    "type": "EXIT",
    "count": 3
  },
  // Extra state for Shizuka
  {
    "type": "ENTER",
    "index": [96, "settings", "npcStates"]
  },
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "reactType": "FIXED_POS",
      "position": {
        "x": 548,
        "y": 475,
        "lvl": 0
      },
      "face": "SOUTH",
      "action": [],
      "hidden": false,
      "condition": "plot.projred.line >= 500 && plot.projred.line <= 600",
      "config": "normal",
      "event": [
        {
          "offsetX": 0,
          "offsetY": 0,
          "speed": "NORMAL",
          "transition": "EASE_IN_OUT",
          "waitSkip": 0,
          "zoom": 1,
          "type": "SET_CAMERA_TARGET",
          "entity": {
            "global": true,
            "name": "shizuka"
          }
        },
        {
          "entity": {
            "player": true
          },
          "action": [
            {
              "type": "SET_RELATIVE_SPEED",
              "value": 0.5
            },
            {
              "type": "NAVIGATE_TO_POINT",
              "target": {
                "x": 548,
                "y": 500,
                "z": 0,
                "lvl": 0
              },
              "precise": true
            },
            {
              "type": "SET_FACE",
              "face": "NORTH",
              "rotate": true,
              "rotateSpeed": 2
            }
          ],
          "type": "DO_ACTION",
          "wait": true
        },
        {
          "entity": {
            "global": true,
            "name": "shizuka"
          },
          "action": [
            {
              "type": "SET_FACE",
              "rotateSpeed": 2,
              "rotate": true,
              "face": "SOUTH"
            }
          ],
          "type": "DO_ACTION"
        },
        {
          "person": {
            "person": "main.lea",
            "expression": "DEFAULT"
          },
          "type": "ADD_MSG_PERSON",
          "side": "RIGHT"
        },
        {
          "person": {
            "person": "main.shizuka",
            "expression": "BRIGHT"
          },
          "type": "ADD_MSG_PERSON",
          "side": "LEFT"
        },
        {
          "person": {
            "person": "main.shizuka",
            "expression": "BRIGHT"
          },
          "message": {
            "en_US": "Hi Lea!"
          },
          "type": "SHOW_MSG"
        },
        {
          "person": {
            "person": "main.lea",
            "expression": "EXCITED"
          },
          "message": {
            "en_US": "Hi!"
          },
          "type": "SHOW_MSG"
        },
        {
          "type": "SET_MSG_EXPRESSION",
          "person": {
            "person": "main.lea",
            "expression": "DEFAULT"
          }
        },
        {
          "person": {
            "person": "main.shizuka",
            "expression": "DEFAULT"
          },
          "message": {
            "en_US": "Satoshi said he wanted to talk with the both of us, so I decided I'd wait for you."
          },
          "type": "SHOW_MSG"
        },
        {
          "person": {
            "person": "main.shizuka",
            "expression": "DEFAULT"
          },
          "message": {
            "en_US": "Should we head inside?"
          },
          "type": "SHOW_MSG"
        },
        {
          "0": [
            {
              "person": {
                "person": "main.lea",
                "expression": "NOD"
              },
              "message": {
                "en_US": "[nods]"
              },
              "type": "SHOW_MSG"
            },
            {
              "person": {
                "person": "main.shizuka",
                "expression": "TOWARD"
              },
              "message": {
                "en_US": "Alright, let's see what he has to say."
              },
              "type": "SHOW_MSG"
            },
            {
              "type": "CHANGE_VAR_NUMBER",
              "varName": "plot.projred.line",
              "changeType": "set",
              "value": 550
            }
          ],
          "1": [
            {
              "person": {
                "person": "main.lea",
                "expression": "SHAKE"
              },
              "message": {
                "en_US": "[shakes head]"
              },
              "type": "SHOW_MSG"
            },
            {
              "person": {
                "person": "main.shizuka",
                "expression": "EVIL_GRIN"
              },
              "message": {
                "en_US": "Alright, but don't keep me waiting too long."
              },
              "type": "SHOW_MSG"
            }
          ],
          "type": "SHOW_CHOICE",
          "person": {
            "person": "main.lea",
            "expression": "DEFAULT"
          },
          "options": [
            {
              "label": {
                "en_US": "[yes]"
              }
            },
            {
              "label": {
                "en_US": "[no]"
              }
            }
          ]
        }
      ]
    }
  },
  {
    "type": "EXIT",
    "count": 3
  },
  // Pillow for Lea to sit on
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "type": "Prop",
      "x": 542,
      "y": 365,
      "level": 0,
      "settings": {
        "mapId": 116,
        "propType": {
          "sheet": "forest-interior",
          "name": "pillow2"
        },
        "propAnim": "",
        "condAnims": [],
        "spawnCondition": "tmp.pillowThere"
      }
    }
  },
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "type": "TeleportField",
      "x": 451,
      "y": 307,
      "level": 0,
      "settings": {
        "size": {
          "x": 16,
          "y": 16
        },
        "mapId": 120,
        "name": "leaTp",
        "dir": "SOUTH",
        "gfxType": "AR",
        "spawnCondition": "tmp.teleporterThere"
      }
    }
  },
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "type": "TeleportField",
      "x": 579,
      "y": 307,
      "level": 0,
      "settings": {
        "size": {
          "x": 16,
          "y": 16
        },
        "mapId": 119,
        "name": "shizuTp",
        "dir": "SOUTH",
        "gfxType": "AR",
        "spawnCondition": "tmp.teleporterThere"
      }
    }
  },
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "type": "Prop",
      "x": 527,
      "y": 352,
      "level": 0,
      "settings": {
        "name": "",
        "propType": {
          "sheet": "forest-interior",
          "name": "chair-satoshi"
        },
        "propAnim": "",
        "spawnCondition": "tmp.satoshiChair2",
        "mapId": 121,
        "condAnims": []
      }
    }
  },
  // Explanation intro cutscene
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "type": "EventTrigger",
      "x": 645,
      "y": 239,
      "level": 0,
      "settings": {
        "mapId": 115,
        "event": [
          {
            "overMessage": false,
            "type": "SET_OVERLAY",
            "color": "black",
            "alpha": 1,
            "time": 0
          },
          // spawn the magic pillow
          {
            "type": "CHANGE_VAR_BOOL",
            "varName": "tmp.pillowThere",
            "changeType": "set",
            "value": true
          },
          {
            "entity": {
              "player": true
            },
            "action": [
              {
                "type": "SET_POS",
                "newPos": {
                  "x": 550,
                  "y": 377,
                  "z": 0,
                  "lvl": 0
                }
              },
              {
                "type": "SET_FACE",
                "face": "NORTH",
                "rotate": false,
                "rotateSpeed": 3
              },
              {
                "type": "SHOW_EXTERN_ANIM",
                "anim": {
                  "sheet": "player-poses",
                  "name": "sitGroundFaceUpLeft"
                }
              }
            ],
            "type": "DO_ACTION",
            "keepState": true
          },
          {
            "type": "WAIT",
            "time": 0.5
          },
          {
            "type": "PLAY_BGM",
            "bgm": "puzzle-pg",
            "volume": 1,
            "mode": "SLOW"
          },
          {
            "overMessage": false,
            "type": "SET_OVERLAY",
            "color": "black",
            "alpha": 0,
            "time": 1
          },
          {
            "zoom": 1.5,
            "transition": "EASE_IN_OUT",
            "type": "SET_CAMERA_ZOOM",
            "duration": 2
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "NERVOUS"
            },
            "type": "ADD_MSG_PERSON",
            "side": "RIGHT"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "DEFAULT"
            },
            "type": "ADD_MSG_PERSON",
            "side": "LEFT"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DEFAULT"
            },
            "message": {
              "en_US": "Thank you for coming, Lea."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DEFAULT"
            },
            "message": {
              "en_US": "Last night, I got a call from one of my colleagues in the development department."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "Apparently, they had not been completely transparent with me for a while, but for a reason."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "SURPRISED_TOWARD"
            },
            "message": {
              "en_US": "...?"
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "Shortly after your most recent entrance into the Evotarground, he had been put in charge of further developing the area."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "They named the operation...\\. \\c[1]Project Red\\c[0]."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "SURPRISED"
            },
            "message": {
              "en_US": "...!"
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DEFAULT"
            },
            "message": {
              "en_US": "Obviously, Instatainment became aware of the area's existence after all the discourse."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "It seems they are trying to use it as a way to expand CrossWorlds' content to keep players busy while waiting for the new game."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DEFAULT"
            },
            "message": {
              "en_US": "I'm not sure how to feel about this."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "THINKING"
            },
            "message": {
              "en_US": "..."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "Frankly, this situation is already getting on my nerves."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "Using an area with such emotional weight for many people was the last thing I needed."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "SAD"
            },
            "message": {
              "en_US": "..."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DEFAULT"
            },
            "message": {
              "en_US": "Anyways, despite all that, I do have something for you to do."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "SURPRISED_TOWARD"
            },
            "message": {
              "en_US": "...?"
            },
            "type": "SHOW_MSG"
          },
          {
            "name": "This isn't a label, but a note. Should probably expand a bit on the below four messages, as it's a bit short...",
            "type": "LABEL"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_SIDE"
            },
            "message": {
              "en_US": "I need you to return to the hidden entrance that leads to the Evotarground."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_SIDE"
            },
            "message": {
              "en_US": "Please see if you can already access it. "
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "PROUD"
            },
            "message": {
              "en_US": "...!"
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.genius",
              "expression": "CHAIR_DOWN"
            },
            "message": {
              "en_US": "Thank you."
            },
            "type": "SHOW_MSG"
          },
          {
            "type": "CLEAR_MSG",
            "side": "ALL"
          },
          {
            "zoom": 1,
            "transition": "EASE_IN_OUT",
            "type": "SET_CAMERA_ZOOM",
            "duration": 1
          },
          {
            "entity": {
              "player": true
            },
            "action": [
              {
                "type": "SHOW_EXTERN_ANIM",
                "anim": {
                  "sheet": "player-poses",
                  "name": "landOnGround"
                }
              },
              {
                "type": "WAIT",
                "time": 0.2
              },
              {
                "type": "CLEAR_ANIMATION"
              },
              {
                "type": "SET_FACE",
                "face": "NORTH",
                "rotateSpeed": 3
              },
              {
                "type": "WAIT",
                "time": 0.2
              }
            ],
            "type": "DO_ACTION",
            "keepState": true,
            "wait": true
          },
          {
            "changeType": "set",
            "type": "CHANGE_VAR_BOOL",
            "varName": "tmp.codeStopped",
            "value": false
          },
          {
            "entity": {
              "player": true
            },
            "action": [
              {
                "type": "SET_RELATIVE_SPEED",
                "value": 0.5
              },
              {
                "type": "MOVE_TO_POINT",
                "target": {
                  "x": 528,
                  "y": 412,
                  "z": 0,
                  "lvl": 0
                },
                "precise": false,
                "forceTime": false
              },
              {
                "type": "MOVE_TO_POINT",
                "target": {
                  "x": 528,
                  "y": 506,
                  "z": 0,
                  "lvl": 0
                },
                "precise": true,
                "forceTime": false
              }
            ],
            "type": "DO_ACTION",
            "keepState": true
          },
          {
            "type": "WAIT",
            "time": 1.2
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "DEFAULT"
            },
            "type": "ADD_MSG_PERSON",
            "side": "LEFT"
          },
          {
            "person": {
              "person": "main.sergey",
              "expression": "THINKING"
            },
            "type": "ADD_MSG_PERSON",
            "side": "RIGHT"
          },
          {
            "person": {
              "person": "main.sergey",
              "expression": "THINKING"
            },
            "message": {
              "en_US": "Did I hear that right? Are they planning to officially introduce Vermillion Wasteland?"
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "NOD"
            },
            "message": {
              "en_US": "[nods]"
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.sergey",
              "expression": "WORRIED"
            },
            "message": {
              "en_US": "That is slightly concerning..."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.sergey",
              "expression": "EYES_CLOSED"
            },
            "message": {
              "en_US": "I had expected as much. The moment they found out about it, they would obviously consider its potential."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "SAD"
            },
            "message": {
              "en_US": "..."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.sergey",
              "expression": "NOTIFYING"
            },
            "message": {
              "en_US": "Anyways, let us take a look at the hidden entrance, Lea."
            },
            "type": "SHOW_MSG"
          },
          {
            "person": {
              "person": "main.lea",
              "expression": "NOD"
            },
            "message": {
              "en_US": "[nods]"
            },
            "type": "SHOW_MSG"
          },
          {
            "type": "CLEAR_MSG",
            "side": "ALL"
          },
          {
            "entity": {
              "player": true
            },
            "action": [
              {
                "type": "SET_RELATIVE_SPEED",
                "value": 1
              },
              {
                "type": "NAVIGATE_TO_POINT",
                "target": {
                  "x": 452,
                  "y": 556,
                  "z": 0,
                  "lvl": 0
                }
              },
              {
                "type": "NAVIGATE_TO_ENTITY",
                "entity": {
                  "global": true,
                  "name": "exit"
                },
                "precise": true
              }
            ],
            "type": "DO_ACTION",
            "keepState": true
          },
          {
            "overMessage": false,
            "type": "SET_OVERLAY",
            "color": "black",
            "alpha": 1,
            "time": 1
          },
          {
            "type": "WAIT",
            "time": 1
          },
          {
            "type": "CHANGE_VAR_NUMBER",
            "varName": "plot.projred.line",
            "changeType": "set",
            "value": 300
          },
          {
            "type": "RESUME_DEFAULT_BGM",
            "mode": "MEDIUM",
            "delayed": false
          },
          {
            "type": "TELEPORT",
            "map": "forest.path-10"
          }
        ],
        "name": "PRReveal",
        "startCondition": "plot.projred.line >= 210",
        "endCondition": "plot.projred.line >= 250",
        "triggerType": "ALWAYS",
        "eventType": "CUTSCENE"
      }
    }
  },
  {
    "type": "ADD_ARRAY_ELEMENT",
    "content": {
      "type": "EventTrigger",
      "x": 645,
      "y": 256,
      "level": 0,
      "settings": {
        "size": {
          "x": 16,
          "y": 16
        },
        "mapId": 118,
        "event": [
          {
            "entity": {
              "global": true,
              "name": "shizuka"
            },
            "action": [
              {
                "type": "MOVE_TO_POINT",
                "target": {
                  "x": 527,
                  "y": 465,
                  "z": 0,
                  "lvl": 0
                }
              }
            ],
            "type": "DO_ACTION",
            "wait": true
          },
          {
            "entity": {
              "player": true
            },
            "action": [
              {
                "type": "SET_RELATIVE_SPEED",
                "value": 0.5
              },
              {
                "type": "NAVIGATE_TO_POINT",
                "target": {
                  "x": 527,
                  "y": 465,
                  "z": 0,
                  "lvl": 0
                }
              }
            ],
            "type": "DO_ACTION",
            "keepState": true
          },
          {
            "entity": {
              "global": true,
              "name": "shizuka"
            },
            "action": [
              {
                "type": "MOVE_TO_POINT",
                "target": {
                  "x": 527,
                  "y": 431,
                  "z": 0,
                  "lvl": 0
                }
              },
              {
                "type": "MOVE_TO_POINT",
                "target": {
                  "x": 544,
                  "y": 416,
                  "z": 0,
                  "lvl": 0
                },
                "precise": true
              },
              {
                "type": "SET_FACE",
                "face": "NORTH",
                "rotate": true,
                "rotateSpeed": 3
              }
            ],
            "type": "DO_ACTION"
          },
          {
            "entity": {
              "player": true
            },
            "action": [
              {
                "type": "SET_RELATIVE_SPEED",
                "value": 0.5
              },
              {
                "type": "NAVIGATE_TO_POINT",
                "target": {
                  "x": 527,
                  "y": 431,
                  "z": 0,
                  "lvl": 0
                }
              },
              {
                "type": "NAVIGATE_TO_POINT",
                "target": {
                  "x": 512,
                  "y": 416,
                  "z": 0,
                  "lvl": 0
                },
                "precise": true
              },
              {
                "type": "SET_FACE",
                "face": "NORTH",
                "rotate": true,
                "rotateSpeed": 3
              }
            ],
            "type": "DO_ACTION",
            "wait": true
          },
          {
            "person": {
              "person": "main.shizuka",
              "expression": "BADASS"
            },
            "type": "ADD_MSG_PERSON",
            "side": "RIGHT"
          },
          {
            "person": {
              "person": "main.shizuka",
              "expression": "BADASS"
            },
            "message": {
              "en_US": "This comes from the cutscene"
            },
            "type": "SHOW_MSG"
          },
          {
            "type": "CHANGE_VAR_NUMBER",
            "varName": "plot.projred.line",
            "changeType": "set",
            "value": 600
          },
          {
            "type": "IF",
            "condition": "false",
            "thenStep": [
              {
                "entity": {
                  "global": true,
                  "name": "shizuka"
                },
                "action": [
                  {
                    "type": "MOVE_TO_POINT",
                    "target": {
                      "x": 527,
                      "y": 465,
                      "z": 0,
                      "lvl": 0
                    }
                  },
                  {
                    "type": "MOVE_TO_POINT",
                    "target": {
                      "x": 527,
                      "y": 431,
                      "z": 0,
                      "lvl": 0
                    }
                  },
                  {
                    "type": "MOVE_TO_POINT",
                    "target": {
                      "x": 544,
                      "y": 416,
                      "z": 0,
                      "lvl": 0
                    }
                  }
                ],
                "type": "DO_ACTION"
              }
            ]
          }
        ],
        "name": "PRDiscuss",
        "eventType": "CUTSCENE",
        "startCondition": "plot.projred.line >= 550",
        "endCondition": "plot.projred.line >= 600",
        "triggerType": "ALWAYS"
      }
    }
  }
]
